{
    "timeout": "1200s",
    "steps": [{
        "name": "gcr.io/$PROJECT_ID/patch:rc-d00d49c",
        "entrypoint": "/app/backend/functions/infra/bin/run",
        "args": [
            "config:generate",
            "-e",
            "$_ENVIRONMENT",
            "--toFile",
            "secretConfig.txt",
            "--secretVersionInfo",
            "--noComments"
        ]
    },
    {
        "name": "gcr.io/cloud-builders/gcloud",
        "entrypoint": "bash",
        "args": [
            "-c",
            "gcloud beta run services update $_SERVICE --region=us-central1 --set-secrets=$(cat secretConfig.txt)"
        ]
    }],
    "availableSecrets": {
        "secretManager": [
            {
                "versionName": "projects/$PROJECT_ID/secrets/infra-git-ssh-key/versions/latest",
                "env": "SSH_KEY"
            }
        ] 
    }
}